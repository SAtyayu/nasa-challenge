{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/pc/Desktop/new/src/components/map/safe-city-map.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport type { City } from '@/lib/types';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\r\nimport { LandUseIcon } from '../icons';\r\n\r\n// Helper to get marker color based on z_metric\r\nconst getMarkerColor = (z_metric: number) => {\r\n  const hue = (1 - z_metric) * 120; // 0 -> 120 (green), 1 -> 0 (red)\r\n  return `hsl(${hue}, 90%, 45%)`;\r\n};\r\n\r\nconst createCustomIcon = (city: City) => {\r\n  const markerHtml = `\r\n    <div style=\"\r\n      background-color: ${getMarkerColor(city.z_metric)};\r\n      width: 24px;\r\n      height: 24px;\r\n      border-radius: 50%;\r\n      border: 2px solid white;\r\n      box-shadow: 0 0 5px rgba(0,0,0,0.5);\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      color: white;\r\n      font-size: 12px;\r\n      font-weight: bold;\r\n    \">\r\n    </div>`;\r\n\r\n  return L.divIcon({\r\n    html: markerHtml,\r\n    className: 'custom-leaflet-icon',\r\n    iconSize: [24, 24],\r\n    iconAnchor: [12, 24],\r\n    popupAnchor: [0, -24],\r\n  });\r\n};\r\n\r\ninterface CityMapProps {\r\n  cities: City[];\r\n  selectedCity: City | null;\r\n  onSelectCity: (city: City | null) => void;\r\n}\r\n\r\nconst SafeCityMap: React.FC<CityMapProps> = ({ cities, selectedCity, onSelectCity }) => {\r\n  const mapRef = useRef<L.Map | null>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [isClient, setIsClient] = useState(false);\r\n  const [mapKey, setMapKey] = useState(0);\r\n  const [isMapReady, setIsMapReady] = useState(false);\r\n\r\n  // Ensure we're on the client side with a delay\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setIsClient(true);\r\n    }, 100);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  // Clean up any existing maps and force remount\r\n  useEffect(() => {\r\n    if (!isClient) return;\r\n\r\n    // Clean up any existing leaflet containers\r\n    if (containerRef.current) {\r\n      const existingContainers = containerRef.current.querySelectorAll('.leaflet-container');\r\n      existingContainers.forEach(el => el.remove());\r\n    }\r\n\r\n    const cleanup = () => {\r\n      if (mapRef.current) {\r\n        try {\r\n          mapRef.current.remove();\r\n        } catch (e) {\r\n          // Ignore errors\r\n        }\r\n        mapRef.current = null;\r\n      }\r\n    };\r\n\r\n    // Clean up on unmount\r\n    return cleanup;\r\n  }, [isClient]);\r\n\r\n  const handleMapReady = () => {\r\n    setIsMapReady(true);\r\n  };\r\n\r\n  const handleMapCreated = (map: L.Map) => {\r\n    mapRef.current = map;\r\n  };\r\n\r\n  // Handle city selection\r\n  useEffect(() => {\r\n    if (mapRef.current && selectedCity && isMapReady) {\r\n      mapRef.current.flyTo([selectedCity.latitude, selectedCity.longitude], 6);\r\n    }\r\n  }, [selectedCity, isMapReady]);\r\n\r\n  if (!isClient) {\r\n    return <div className=\"h-full w-full bg-gray-100 animate-pulse\" />;\r\n  }\r\n\r\n  return (\r\n    <div ref={containerRef} className=\"h-full w-full\">\r\n      <MapContainer\r\n        key={mapKey}\r\n        center={[20, 0]}\r\n        zoom={2.5}\r\n        style={{ height: '100%', width: '100%' }}\r\n        worldCopyJump={true}\r\n        whenReady={handleMapReady}\r\n        ref={handleMapCreated}\r\n      >\r\n        <TileLayer\r\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        />\r\n        {cities.map(city => (\r\n          <Marker\r\n            key={city.id}\r\n            position={[city.latitude, city.longitude]}\r\n            icon={createCustomIcon(city)}\r\n            eventHandlers={{\r\n              click: () => {\r\n                onSelectCity(city);\r\n              },\r\n            }}\r\n          />\r\n        ))}\r\n        {selectedCity && isMapReady && (\r\n          <Popup\r\n            position={[selectedCity.latitude, selectedCity.longitude]}\r\n          >\r\n            <Card className=\"min-w-64 border-none shadow-none\">\r\n              <CardHeader className=\"p-2\">\r\n                <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                  <LandUseIcon landType={selectedCity.land_type} className=\"w-5 h-5\"/>\r\n                  {selectedCity.name}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"p-2 pt-0 text-sm\">\r\n                <p><strong>Population:</strong> {selectedCity.population.toLocaleString()}</p>\r\n                <p><strong>Built-up Area:</strong> {(selectedCity.built_up_area_m2 / 1_000_000).toFixed(2)} kmÂ²</p>\r\n                <p><strong>Z-Metric:</strong> {selectedCity.z_metric.toFixed(2)}</p>\r\n                <p><strong>Land Use:</strong> {selectedCity.land_type}</p>\r\n              </CardContent>\r\n            </Card>\r\n          </Popup>\r\n        )}\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SafeCityMap;\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;;;AAPA;;;;;;AASA,+CAA+C;AAC/C,MAAM,iBAAiB,CAAC;IACtB,MAAM,MAAM,CAAC,IAAI,QAAQ,IAAI,KAAK,iCAAiC;IACnE,OAAO,CAAC,IAAI,EAAE,IAAI,WAAW,CAAC;AAChC;AAEA,MAAM,mBAAmB,CAAC;IACxB,MAAM,aAAa,CAAC;;wBAEE,EAAE,eAAe,KAAK,QAAQ,EAAE;;;;;;;;;;;;;UAa9C,CAAC;IAET,OAAO,oJAAA,CAAA,UAAC,CAAC,OAAO,CAAC;QACf,MAAM;QACN,WAAW;QACX,UAAU;YAAC;YAAI;SAAG;QAClB,YAAY;YAAC;YAAI;SAAG;QACpB,aAAa;YAAC;YAAG,CAAC;SAAG;IACvB;AACF;AAQA,MAAM,cAAsC,CAAC,EAAE,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE;;IACjF,MAAM,SAAS,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAgB;IACpC,MAAM,eAAe,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAkB;IAC5C,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,+CAA+C;IAC/C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;iCAAE;YACR,MAAM,QAAQ;+CAAW;oBACvB,YAAY;gBACd;8CAAG;YACH;yCAAO,IAAM,aAAa;;QAC5B;gCAAG,EAAE;IAEL,+CAA+C;IAC/C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;iCAAE;YACR,IAAI,CAAC,UAAU;YAEf,2CAA2C;YAC3C,IAAI,aAAa,OAAO,EAAE;gBACxB,MAAM,qBAAqB,aAAa,OAAO,CAAC,gBAAgB,CAAC;gBACjE,mBAAmB,OAAO;6CAAC,CAAA,KAAM,GAAG,MAAM;;YAC5C;YAEA,MAAM;iDAAU;oBACd,IAAI,OAAO,OAAO,EAAE;wBAClB,IAAI;4BACF,OAAO,OAAO,CAAC,MAAM;wBACvB,EAAE,OAAO,GAAG;wBACV,gBAAgB;wBAClB;wBACA,OAAO,OAAO,GAAG;oBACnB;gBACF;;YAEA,sBAAsB;YACtB,OAAO;QACT;gCAAG;QAAC;KAAS;IAEb,MAAM,iBAAiB;QACrB,cAAc;IAChB;IAEA,MAAM,mBAAmB,CAAC;QACxB,OAAO,OAAO,GAAG;IACnB;IAEA,wBAAwB;IACxB,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;iCAAE;YACR,IAAI,OAAO,OAAO,IAAI,gBAAgB,YAAY;gBAChD,OAAO,OAAO,CAAC,KAAK,CAAC;oBAAC,aAAa,QAAQ;oBAAE,aAAa,SAAS;iBAAC,EAAE;YACxE;QACF;gCAAG;QAAC;QAAc;KAAW;IAE7B,IAAI,CAAC,UAAU;QACb,qBAAO,6LAAC;YAAI,WAAU;;;;;;IACxB;IAEA,qBACE,6LAAC;QAAI,KAAK;QAAc,WAAU;kBAChC,cAAA,6LAAC,0JAAA,CAAA,eAAY;YAEX,QAAQ;gBAAC;gBAAI;aAAE;YACf,MAAM;YACN,OAAO;gBAAE,QAAQ;gBAAQ,OAAO;YAAO;YACvC,eAAe;YACf,WAAW;YACX,KAAK;;8BAEL,6LAAC,uJAAA,CAAA,YAAS;oBACR,aAAY;oBACZ,KAAI;;;;;;gBAEL,OAAO,GAAG,CAAC,CAAA,qBACV,6LAAC,oJAAA,CAAA,SAAM;wBAEL,UAAU;4BAAC,KAAK,QAAQ;4BAAE,KAAK,SAAS;yBAAC;wBACzC,MAAM,iBAAiB;wBACvB,eAAe;4BACb,OAAO;gCACL,aAAa;4BACf;wBACF;uBAPK,KAAK,EAAE;;;;;gBAUf,gBAAgB,4BACf,6LAAC,mJAAA,CAAA,QAAK;oBACJ,UAAU;wBAAC,aAAa,QAAQ;wBAAE,aAAa,SAAS;qBAAC;8BAEzD,cAAA,6LAAC,mIAAA,CAAA,OAAI;wBAAC,WAAU;;0CACd,6LAAC,mIAAA,CAAA,aAAU;gCAAC,WAAU;0CACpB,cAAA,6LAAC,mIAAA,CAAA,YAAS;oCAAC,WAAU;;sDACnB,6LAAC,8HAAA,CAAA,cAAW;4CAAC,UAAU,aAAa,SAAS;4CAAE,WAAU;;;;;;wCACxD,aAAa,IAAI;;;;;;;;;;;;0CAGtB,6LAAC,mIAAA,CAAA,cAAW;gCAAC,WAAU;;kDACrB,6LAAC;;0DAAE,6LAAC;0DAAO;;;;;;4CAAoB;4CAAE,aAAa,UAAU,CAAC,cAAc;;;;;;;kDACvE,6LAAC;;0DAAE,6LAAC;0DAAO;;;;;;4CAAuB;4CAAE,CAAC,aAAa,gBAAgB,GAAG,SAAS,EAAE,OAAO,CAAC;4CAAG;;;;;;;kDAC3F,6LAAC;;0DAAE,6LAAC;0DAAO;;;;;;4CAAkB;4CAAE,aAAa,QAAQ,CAAC,OAAO,CAAC;;;;;;;kDAC7D,6LAAC;;0DAAE,6LAAC;0DAAO;;;;;;4CAAkB;4CAAE,aAAa,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;WAvCxD;;;;;;;;;;AA+Cb;GA7GM;KAAA;uCA+GS","debugId":null}}]
}